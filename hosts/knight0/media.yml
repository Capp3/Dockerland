services:
  gluetun:
    container_name: media_gluetun
    image: qmcgaw/gluetun
    cap_add:
      - NET_ADMIN
    networks:
      k0_proxy:
    environment:
      - VPN_SERVICE_PROVIDER=private internet access
      - OPENVPN_USER=${PIA_USER}
      - OPENVPN_PASSWORD=${PIA_PASS}
      - SERVER_REGIONS=${PIA_SERVER_REGION:-Netherlands}
    volumes:
      - ${DATA_DIR}/gluetun:/gluetun
    ports:
      - ${DELUGE_GUI_PORT}:8112
      - 6881:6881
      - 6881:6881/udp
      - 58846:58846
      - ${FLARESOLVERR_PORT}:8191
      - ${PROWLARR_PORT}:9696
      - ${RADARR_PORT}:7878
      - ${SONARR_PORT}:8989
      - ${READARR_PORT}:8787
      - ${OVERSEERR_PORT}:5055
      - ${BAZARR_PORT}:6767
    devices:
      - /dev/net/tun:/dev/net/tun
    restart: unless-stopped

  deluge:
    container_name: media_deluge
    image: lscr.io/linuxserver/deluge:latest
    network_mode: 'container:media_gluetun'
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - DELUGE_LOGLEVEL=error # optional
    volumes:
      - ${DATA_DIR}/deluge:/config
      - ${DATA_DIR}/downloads:/downloads
    depends_on:
      gluetun:
        condition: service_healthy
    restart: unless-stopped

  flaresolverr:
    container_name: media_flaresolverr
    image: ghcr.io/flaresolverr/flaresolverr:latest
    network_mode: 'container:media_gluetun'
    environment:
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - LOG_HTML=${LOG_HTML:-false}
      - CAPTCHA_SOLVER=${CAPTCHA_SOLVER:-none}
      - TZ=${TZ}
    depends_on:
      gluetun:
        condition: service_healthy
    restart: unless-stopped

  prowlarr:
    container_name: media_prowlarr
    image: lscr.io/linuxserver/prowlarr:latest
    network_mode: 'container:media_gluetun'
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${DATA_DIR}/prowlarr:/config
    depends_on:
      gluetun:
        condition: service_healthy
    restart: unless-stopped

  radarr:
    container_name: media_radarr
    image: lscr.io/linuxserver/radarr:latest
    network_mode: 'container:media_gluetun'
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${DATA_DIR}/radarr:/config
      - ${MEDIADIR}/movies:/movies # optional
      - ${DATA_DIR}/downloads:/downloads # optional
    depends_on:
      gluetun:
        condition: service_healthy
    restart: unless-stopped

  sonarr:
    container_name: media_sonarr
    image: lscr.io/linuxserver/sonarr:latest
    network_mode: 'container:media_gluetun'
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${DATA_DIR}/sonarr:/config
      - ${MEDIADIR}/tv:/tv # optional
      - ${DATA_DIR}/downloads:/downloads # optional
    depends_on:
      gluetun:
        condition: service_healthy
    restart: unless-stopped

  bazarr:
    container_name: media_bazarr
    image: lscr.io/linuxserver/bazarr:latest
    network_mode: 'container:media_gluetun'
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - ${DATA_DIR}/bazarr/config:/config
      - ${MEDIADIR}/movies:/movies # optional
      - ${MEDIADIR}/tv:/tv # optional
    depends_on:
      gluetun:
        condition: service_healthy
    restart: unless-stopped

  tdarr:
    container_name: media_tdarr
    image: haveagitgat/tdarr
    network_mode: bridge
    tty: true
    stdin_open: true
    environment:
      - serverIP=0.0.0.0
      - webUIPort=8265
      - serverPort=8266
      - TZ=Europe/Dublin
      - internalNode=true
      - inContainer=true
      - PUID=1000
      - PGID=1000
      - nodeName=knight0
    volumes:
      - ${MEDIADIR}/movies:/home/Tdarr/Media/movies
      - ${MEDIADIR}/tv:/home/Tdarr/Media/tv
      - ${DATA_DIR}/downloads/cache/:/temp
      - ${DATA_DIR}/tdarr/data/:/app/server
      - ${DATA_DIR}/tdarr/data/:/app/configs
      - ${DATA_DIR}/tdarr/data/:/app/logs
    ports:
      - 8265:8265
      - 8266:8266
    devices:
      - /dev/dri:/dev/dri
    logging:
      options:
        max-size: 10m
        max-file: 5
    restart: unless-stopped

  jellyseerr:
    image: fallenbagel/jellyseerr:latest
    container_name: media_jellyseerr
    environment:
      - LOG_LEVEL=debug
      - TZ=${TZ}
      - PORT=5055 # optional
    volumes:
      - ${DATA_DIR}/jellyseerr:/app/config
    restart: unless-stopped
    depends_on:
      gluetun:
        condition: service_healthy
    network_mode: 'container:media_gluetun'
